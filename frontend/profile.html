<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Scopira</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .profile-image-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
        }
        
        .profile-image {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            border: 3px solid #fff;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .profile-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .profile-image-overlay {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 35px;
            height: 35px;
            background: #4361ee;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            cursor: pointer;
            border: 2px solid #fff;
            transition: all 0.3s ease;
        }
        
        .profile-image-overlay:hover {
            background: #3046b5;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <nav class="navbar">
            <div class="nav-container">
                <div class="logo">
                    <h2><i class="fas fa-compass"></i> Scopira</h2>
                </div>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="index.html" class="nav-link">Home</a>
                    </li>
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a href="jobs.html" class="nav-link">Jobs</a>
                    </li>
                    <li class="nav-item">
                        <a href="portfolio.html" class="nav-link">Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a href="profile.html" class="nav-link">Profile</a>
                    </li>
                    <!-- User Profile Dropdown -->
                    <li class="nav-item user-dropdown">
                        <a href="#" class="nav-link user-link">
                            <i class="fas fa-user-circle"></i> John Doe <i class="fas fa-caret-down"></i>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="profile.html"><i class="fas fa-user"></i> My Profile</a></li>
                            <li><a href="resume-editor.html"><i class="fas fa-file-alt"></i> Resume Editor</a></li>
                            <li><a href="portfolio.html"><i class="fas fa-briefcase"></i> My Portfolio</a></li>
                            <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
                        </ul>
                    </li>
                </ul>
                <div class="hamburger">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Profile Section -->
    <section id="profile" class="profile">
        <div class="container">
            <h1>My Profile</h1>
            
            <div class="profile-content">
                <!-- Profile Sidebar -->
                <div class="profile-sidebar">
                    <div class="profile-card">
                        <div class="profile-image-container">
                            <div class="profile-image">
                                <img src="assets/profile-placeholder.png" alt="Profile Image" id="profile-img-display">
                            </div>
                            <div class="profile-image-overlay" id="upload-profile-pic-btn">
                                <i class="fas fa-camera"></i>
                            </div>
                            <input type="file" id="profile-pic-input" accept="image/*" style="display: none;">
                        </div>
                        <h2>John Doe</h2>
                        <p>Senior Data Scientist</p>
                        <div class="profile-stats">
                            <div class="stat">
                                <span class="stat-value">12</span>
                                <span class="stat-label">Job Matches</span>
                            </div>
                            <div class="stat">
                                <span class="stat-value">85%</span>
                                <span class="stat-label">Profile Complete</span>
                            </div>
                        </div>
                        <button class="btn primary-btn"><i class="fas fa-edit"></i> Edit Profile</button>
                    </div>
                    
                    <div class="profile-menu">
                        <ul>
                            <li class="active"><a href="#basic-info"><i class="fas fa-user"></i> Basic Information</a></li>
                            <li><a href="#resume"><i class="fas fa-file-alt"></i> Resume</a></li>
                            <li><a href="#skills"><i class="fas fa-star"></i> Skills</a></li>
                            <li><a href="#experience"><i class="fas fa-briefcase"></i> Experience</a></li>
                            <li><a href="#education"><i class="fas fa-graduation-cap"></i> Education</a></li>
                            <li><a href="#preferences"><i class="fas fa-cog"></i> Job Preferences</a></li>
                            <li><a href="#settings"><i class="fas fa-sliders-h"></i> Settings</a></li>
                        </ul>
                    </div>
                </div>
                
                <!-- Profile Main Content -->
                <div class="profile-main">
                    <!-- Basic Information -->
                    <div id="basic-info" class="profile-section">
                        <h2><i class="fas fa-user"></i> Basic Information</h2>
                        <form class="profile-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="first-name">First Name</label>
                                    <input type="text" id="first-name" value="John">
                                </div>
                                <div class="form-group">
                                    <label for="last-name">Last Name</label>
                                    <input type="text" id="last-name" value="Doe">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" value="john.doe@example.com">
                            </div>
                            <div class="form-group">
                                <label for="phone">Phone</label>
                                <input type="tel" id="phone" value="+1 (555) 123-4567">
                            </div>
                            <div class="form-group">
                                <label for="location">Location</label>
                                <input type="text" id="location" value="San Francisco, CA">
                            </div>
                            <div class="form-group">
                                <label for="profession">Profession</label>
                                <input type="text" id="profession" placeholder="e.g. Data Scientist">
                            </div>
                            <div class="form-group">
                                <label for="headline">Professional Headline</label>
                                <input type="text" id="headline" value="Senior Data Scientist">
                            </div>
                            <div class="form-group">
                                <label for="summary">Professional Summary</label>
                                <textarea id="summary" rows="5">Passionate data scientist with 5+ years of experience in machine learning, statistical analysis, and data visualization. Specialize in Python, TensorFlow, and cloud-based data solutions.</textarea>
                            </div>
                            <button type="submit" class="btn primary-btn">Save Changes</button>
                        </form>
                    </div>
                    
                    <!-- Resume Section -->
                    <div id="resume" class="profile-section">
                        <h2><i class="fas fa-file-alt"></i> Resume</h2>
                        <div class="resume-upload">
                            <div class="upload-area">
                                <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                <p>Drag & drop your resume here or click to browse</p>
                                <p class="file-types">Supported formats: PDF, DOCX (Max 5MB)</p>
                                <button class="btn primary-btn">Choose File</button>
                                <input type="file" id="resume-file" accept=".pdf,.docx" style="display: none;">
                            </div>
                        </div>
                        
                        <div class="uploaded-resumes">
                            <h3>Uploaded Resumes</h3>
                            <div class="resume-list">
                                <div class="resume-item">
                                    <div class="resume-info">
                                        <h4>John_Doe_Resume.pdf</h4>
                                        <p>Uploaded on: Oct 15, 2025</p>
                                    </div>
                                    <div class="resume-actions">
                                        <button class="btn secondary-btn"><i class="fas fa-download"></i> Download</button>
                                        <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                    </div>
                                </div>
                                <div class="resume-item">
                                    <div class="resume-info">
                                        <h4>John_Doe_Resume_v2.pdf</h4>
                                        <p>Uploaded on: Sep 20, 2025</p>
                                    </div>
                                    <div class="resume-actions">
                                        <button class="btn secondary-btn"><i class="fas fa-download"></i> Download</button>
                                        <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Skills Section -->
                    <div id="skills" class="profile-section">
                        <h2><i class="fas fa-star"></i> Skills</h2>
                        <div class="skills-form">
                            <div class="form-group">
                                <label for="skill-input">Add Skill</label>
                                <div class="skill-input-container">
                                    <input type="text" id="skill-input" placeholder="Enter a skill">
                                    <select id="proficiency-level">
                                        <option value="1">Beginner</option>
                                        <option value="2">Intermediate</option>
                                        <option value="3" selected>Advanced</option>
                                        <option value="4">Expert</option>
                                    </select>
                                    <button class="btn primary-btn">Add</button>
                                </div>
                            </div>
                            
                            <div class="skills-list">
                                <div class="skill-item">
                                    <span class="skill-name">Python</span>
                                    <div class="skill-proficiency">
                                        <div class="proficiency-bar">
                                            <div class="proficiency-level" style="width: 90%;"></div>
                                        </div>
                                        <span class="proficiency-text">Advanced</span>
                                    </div>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">Machine Learning</span>
                                    <div class="skill-proficiency">
                                        <div class="proficiency-bar">
                                            <div class="proficiency-level" style="width: 85%;"></div>
                                        </div>
                                        <span class="proficiency-text">Advanced</span>
                                    </div>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">SQL</span>
                                    <div class="skill-proficiency">
                                        <div class="proficiency-bar">
                                            <div class="proficiency-level" style="width: 80%;"></div>
                                        </div>
                                        <span class="proficiency-text">Advanced</span>
                                    </div>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">Data Visualization</span>
                                    <div class="skill-proficiency">
                                        <div class="proficiency-bar">
                                            <div class="proficiency-level" style="width: 75%;"></div>
                                        </div>
                                        <span class="proficiency-text">Intermediate</span>
                                    </div>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                                </div>
                                <div class="skill-item">
                                    <span class="skill-name">Statistical Analysis</span>
                                    <div class="skill-proficiency">
                                        <div class="proficiency-bar">
                                            <div class="proficiency-level" style="width: 82%;"></div>
                                        </div>
                                        <span class="proficiency-text">Advanced</span>
                                    </div>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Experience Section -->
                    <div id="experience" class="profile-section">
                        <h2><i class="fas fa-briefcase"></i> Experience</h2>
                        <form class="profile-form">
                            <div class="form-group">
                                <label for="job-title">Job Title</label>
                                <input type="text" id="job-title" placeholder="e.g., Senior Data Scientist">
                            </div>
                            <div class="form-group">
                                <label for="company">Company</label>
                                <input type="text" id="company" placeholder="e.g., TechCorp Inc.">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="start-date">Start Date</label>
                                    <input type="month" id="start-date">
                                </div>
                                <div class="form-group">
                                    <label for="end-date">End Date</label>
                                    <input type="month" id="end-date">
                                    <div class="form-check">
                                        <input type="checkbox" id="current-job">
                                        <label for="current-job">I currently work here</label>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="job-description">Description</label>
                                <textarea id="job-description" rows="4" placeholder="Describe your responsibilities and achievements..."></textarea>
                            </div>
                            <button type="submit" class="btn primary-btn">Add Experience</button>
                        </form>
                        
                        <div class="experience-list">
                            <div class="experience-item">
                                <h3>Senior Data Scientist</h3>
                                <p class="company">TechCorp Inc.</p>
                                <p class="duration">Jan 2022 - Present</p>
                                <p>Lead machine learning initiatives and mentor junior data scientists. Developed recommendation systems that increased user engagement by 35%.</p>
                                <div class="experience-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                            <div class="experience-item">
                                <h3>Data Scientist</h3>
                                <p class="company">DataSystems Ltd</p>
                                <p class="duration">Mar 2020 - Dec 2021</p>
                                <p>Built predictive models for customer behavior analysis. Reduced customer churn by 20% through targeted interventions.</p>
                                <div class="experience-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                            <div class="experience-item">
                                <h3>Data Analyst</h3>
                                <p class="company">StartupXYZ</p>
                                <p class="duration">Jun 2018 - Feb 2020</p>
                                <p>Performed statistical analysis and created dashboards for business intelligence. Automated reporting processes, saving 10 hours per week.</p>
                                <div class="experience-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Education Section -->
                    <div id="education" class="profile-section">
                        <h2><i class="fas fa-graduation-cap"></i> Education</h2>
                        <form class="profile-form">
                            <div class="form-group">
                                <label for="degree">Degree</label>
                                <input type="text" id="degree" placeholder="e.g., Master of Science in Data Science">
                            </div>
                            <div class="form-group">
                                <label for="institution">Institution</label>
                                <input type="text" id="institution" placeholder="e.g., Stanford University">
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="edu-start-date">Start Date</label>
                                    <input type="month" id="edu-start-date">
                                </div>
                                <div class="form-group">
                                    <label for="edu-end-date">End Date</label>
                                    <input type="month" id="edu-end-date">
                                    <div class="form-check">
                                        <input type="checkbox" id="current-study">
                                        <label for="current-study">I currently study here</label>
                                    </div>
                                </div>
                            </div>
                            <button type="submit" class="btn primary-btn">Add Education</button>
                        </form>
                        
                        <div class="education-list">
                            <div class="education-item">
                                <h3>Master of Science in Data Science</h3>
                                <p class="institution">Stanford University</p>
                                <p class="duration">2016 - 2018</p>
                                <p>Specialized in machine learning and statistical modeling. Completed thesis on "Predictive Analytics in Financial Markets".</p>
                                <div class="education-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                            <div class="education-item">
                                <h3>Bachelor of Science in Computer Science</h3>
                                <p class="institution">MIT</p>
                                <p class="duration">2012 - 2016</p>
                                <p>Graduated with honors. Focused on artificial intelligence and data structures.</p>
                                <div class="education-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-edit"></i> Edit</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Job Preferences Section -->
                    <div id="preferences" class="profile-section">
                        <h2><i class="fas fa-cog"></i> Job Preferences</h2>
                        <form class="profile-form">
                            <div class="form-group">
                                <label for="preferred-roles">Preferred Job Roles</label>
                                <input type="text" id="preferred-roles" placeholder="e.g., Data Scientist, Machine Learning Engineer" value="Data Scientist, Machine Learning Engineer, AI Researcher">
                            </div>
                            <div class="form-group">
                                <label for="preferred-location">Preferred Location</label>
                                <input type="text" id="preferred-location" placeholder="e.g., San Francisco, Remote" value="San Francisco, CA; Remote">
                            </div>
                            <div class="form-group">
                                <label for="salary-expectations">Salary Expectations</label>
                                <input type="text" id="salary-expectations" placeholder="e.g., $120,000 - $150,000" value="$130,000 - $160,000">
                            </div>
                            <div class="form-group">
                                <label for="job-type-preference">Job Type Preference</label>
                                <select id="job-type-preference">
                                    <option value="">Select preference</option>
                                    <option value="full-time" selected>Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="internship">Internship</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="work-environment">Preferred Work Environment</label>
                                <select id="work-environment">
                                    <option value="">Select preference</option>
                                    <option value="remote" selected>Remote</option>
                                    <option value="hybrid">Hybrid</option>
                                    <option value="onsite">On-site</option>
                                </select>
                            </div>
                            <button type="submit" class="btn primary-btn">Save Preferences</button>
                        </form>
                    </div>
                    
                    <!-- Settings Section -->
                    <div id="settings" class="profile-section">
                        <h2><i class="fas fa-sliders-h"></i> Account Settings</h2>
                        <form class="profile-form">
                            <div class="form-group">
                                <label for="current-password">Current Password</label>
                                <input type="password" id="current-password">
                            </div>
                            <div class="form-group">
                                <label for="new-password">New Password</label>
                                <input type="password" id="new-password">
                            </div>
                            <div class="form-group">
                                <label for="confirm-password">Confirm New Password</label>
                                <input type="password" id="confirm-password">
                            </div>
                            <button type="submit" class="btn primary-btn">Change Password</button>
                        </form>
                        
                        <div class="settings-section">
                            <h3>Privacy Settings</h3>
                            <div class="form-check">
                                <input type="checkbox" id="profile-public" checked>
                                <label for="profile-public">Make my profile public</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="resume-visible" checked>
                                <label for="resume-visible">Allow employers to view my resume</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="job-alerts" checked>
                                <label for="job-alerts">Send me job alerts</label>
                            </div>
                            <div class="form-check">
                                <input type="checkbox" id="newsletter" checked>
                                <label for="newsletter">Subscribe to career newsletter</label>
                            </div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>Account Deletion</h3>
                            <p>Deleting your account will permanently remove all your data. This action cannot be undone.</p>
                            <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete Account</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="footer-container">
            <div class="footer-logo">
                <h3><i class="fas fa-compass"></i> Scopira</h3>
                <p>AI-Powered Career Guidance Platform</p>
            </div>
            <div class="footer-links">
                <h4>Quick Links</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="jobs.html">Jobs</a></li>
                    <li><a href="portfolio.html">Portfolio</a></li>
                </ul>
            </div>
            <div class="footer-social">
                <h4>Follow Us</h4>
                <div class="social-icons">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-linkedin"></i></a>
                    <a href="#"><i class="fab fa-github"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Scopira. All rights reserved.</p>
        </div>
    </footer>

    <script src="js/main.js"></script>
    <script>
        // API Base URL
        const API_BASE = 'http://localhost:5000/api';
        let currentUser = null;
        
        // Test API connection
        async function testAPIConnection() {
            try {
                const response = await fetch('http://localhost:5000/', { method: 'GET' });
                if (response.ok) {
                    console.log('Backend API is connected');
                    return true;
                } else {
                    console.error('Backend API returned error:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('Backend API connection failed:', error);
                showConnectionError();
                return false;
            }
        }
        
        function showConnectionError() {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #ff4757;
                color: white;
                padding: 15px;
                border-radius: 5px;
                z-index: 1000;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            `;
            errorDiv.innerHTML = '<strong>Backend Connection Error!</strong><br>Make sure the backend server is running on port 5000.';
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 10000);
        }

        // Smooth scrolling for profile menu
        document.querySelectorAll('.profile-menu a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all menu items
                document.querySelectorAll('.profile-menu li').forEach(li => {
                    li.classList.remove('active');
                });
                
                // Add active class to clicked menu item
                this.parentElement.classList.add('active');
                
                // Scroll to the section
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });
        
        // Highlight active menu item on scroll
        window.addEventListener('scroll', function() {
            const sections = document.querySelectorAll('.profile-section');
            const menuItems = document.querySelectorAll('.profile-menu a');
            
            let current = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop;
                const sectionHeight = section.clientHeight;
                
                if (pageYOffset >= (sectionTop - 200)) {
                    current = section.getAttribute('id');
                }
            });
            
            menuItems.forEach(item => {
                item.parentElement.classList.remove('active');
                if (item.getAttribute('href').substring(1) === current) {
                    item.parentElement.classList.add('active');
                }
            });
        });

        // Load user profile data
        async function loadUserProfile() {
            const userStr = localStorage.getItem('user');
            if (!userStr) {
                // Use default test user for demo purposes
                currentUser = {
                    id: 1,
                    username: 'testuser',
                    email: 'test@example.com',
                    first_name: 'Test',
                    last_name: 'User',
                    phone: '123-456-7890',
                    location: 'Test City',
                    profession: 'Software Developer',
                    headline: 'Test User Profile',
                    summary: 'This is a test user profile'
                };
                localStorage.setItem('user', JSON.stringify(currentUser));
                console.log('Using default test user for demo');
            } else {
                currentUser = JSON.parse(userStr);
            }
            
            try {
                // Fetch latest user data
                const response = await fetch(`${API_BASE}/users/${currentUser.id}`);
                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(currentUser)); // Update local storage
                    
                    // Populate UI
                    document.querySelector('.profile-card h2').textContent = `${currentUser.first_name} ${currentUser.last_name}`;
                    document.querySelector('.profile-card p').textContent = currentUser.headline || currentUser.profession || 'User';
                    
                    // Set profile picture if exists
                    if (currentUser.profile_picture) {
                        // If the path starts with /, append API_BASE's origin (http://localhost:5000)
                        // But API_BASE is http://localhost:5000/api, so we need just the origin.
                        const origin = 'http://localhost:5000';
                        document.getElementById('profile-img-display').src = `${origin}${currentUser.profile_picture}`;
                    }
                    
                    // Populate Basic Info Form
                    document.getElementById('first-name').value = currentUser.first_name || '';
                    document.getElementById('last-name').value = currentUser.last_name || '';
                    document.getElementById('email').value = currentUser.email || '';
                    document.getElementById('phone').value = currentUser.phone || '';
                    document.getElementById('location').value = currentUser.location || '';
                    document.getElementById('profession').value = currentUser.profession || '';
                    document.getElementById('headline').value = currentUser.headline || '';
                    document.getElementById('summary').value = currentUser.summary || '';
                    
                    // Update header user info
                    const userLink = document.querySelector('.user-link');
                    if (userLink) {
                        userLink.innerHTML = `<i class="fas fa-user-circle"></i> ${currentUser.first_name} ${currentUser.last_name} <i class="fas fa-caret-down"></i>`;
                    }
                }
            } catch (error) {
                console.error('Error loading profile:', error);
            }
        }

        // Save Basic Info
        document.querySelector('#basic-info .profile-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const updateBtn = this.querySelector('button[type="submit"]');
            const originalText = updateBtn.textContent;
            updateBtn.textContent = 'Saving...';
            updateBtn.disabled = true;
            
            const updatedData = {
                first_name: document.getElementById('first-name').value,
                last_name: document.getElementById('last-name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                location: document.getElementById('location').value,
                profession: document.getElementById('profession').value,
                headline: document.getElementById('headline').value,
                summary: document.getElementById('summary').value
            };
            
            try {
                // Test connection first
                const connectionOk = await testAPIConnection();
                if (!connectionOk) {
                    alert('Cannot connect to backend server. Please ensure the server is running on port 5000.');
                    return;
                }
                
                console.log('Updating profile for user:', currentUser.id);
                console.log('Update data:', updatedData);
                
                const response = await fetch(`${API_BASE}/users/${currentUser.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updatedData)
                });
                
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Response data:', data);
                    currentUser = data.user;
                    localStorage.setItem('user', JSON.stringify(currentUser));
                    
                    // Show success message
                    const successDiv = document.createElement('div');
                    successDiv.style.cssText = `
                        position: fixed;
                        top: 20px;
                        right: 20px;
                        background: #2ed573;
                        color: white;
                        padding: 15px;
                        border-radius: 5px;
                        z-index: 1000;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    `;
                    successDiv.innerHTML = '<strong>Success!</strong><br>Profile updated successfully!';
                    document.body.appendChild(successDiv);
                    
                    setTimeout(() => {
                        if (successDiv.parentNode) {
                            successDiv.parentNode.removeChild(successDiv);
                        }
                    }, 3000);
                    
                    // Update UI elements
                    document.querySelector('.profile-card h2').textContent = `${currentUser.first_name} ${currentUser.last_name}`;
                    document.querySelector('.profile-card p').textContent = currentUser.headline || 'User';
                } else {
                    const error = await response.json();
                    console.error('API Error:', error);
                    alert(error.error || 'Failed to update profile');
                }
            } catch (error) {
                console.error('Error updating profile:', error);
                alert('An error occurred while updating profile. Check console for details.');
            } finally {
                updateBtn.textContent = originalText;
                updateBtn.disabled = false;
            }
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Test API connection on page load
            await testAPIConnection();
            
            loadUserProfile();
            loadResumes();
            
            // Profile Picture Upload
            const profilePicBtn = document.getElementById('upload-profile-pic-btn');
            const profilePicInput = document.getElementById('profile-pic-input');
            
            if (profilePicBtn && profilePicInput) {
                profilePicBtn.addEventListener('click', () => profilePicInput.click());
                
                profilePicInput.addEventListener('change', async function() {
                    if (this.files && this.files[0]) {
                        const file = this.files[0];
                        const formData = new FormData();
                        formData.append('file', file);
                        
                        // Show loading state
                        const originalIcon = profilePicBtn.innerHTML;
                        profilePicBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                        
                        try {
                            const response = await fetch(`${API_BASE}/users/${currentUser.id}/upload-picture`, {
                                method: 'POST',
                                body: formData
                            });
                            
                            if (response.ok) {
                                const data = await response.json();
                                // Update local user data
                                currentUser.profile_picture = data.profile_picture;
                                localStorage.setItem('user', JSON.stringify(currentUser));
                                
                                // Update image display
                                const origin = 'http://localhost:5000';
                                document.getElementById('profile-img-display').src = `${origin}${data.profile_picture}`;
                                
                                alert('Profile picture updated successfully!');
                            } else {
                                const error = await response.json();
                                alert(error.error || 'Failed to upload profile picture');
                            }
                        } catch (error) {
                            console.error('Error uploading profile picture:', error);
                            alert('An error occurred while uploading profile picture');
                        } finally {
                            profilePicBtn.innerHTML = originalIcon;
                        }
                    }
                });
            }
        });
        
        // Load Resumes
        async function loadResumes() {
            if (!currentUser) return;
            
            try {
                const response = await fetch(`${API_BASE}/resumes/${currentUser.id}`);
                if (response.ok) {
                    const data = await response.json();
                    const resumeList = document.querySelector('.resume-list');
                    
                    if (data.resumes && data.resumes.length > 0) {
                        resumeList.innerHTML = data.resumes.map(resume => `
                            <div class="resume-item">
                                <div class="resume-info">
                                    <h4>${resume.original_filename}</h4>
                                    <p>Uploaded on: ${new Date(resume.uploaded_at).toLocaleDateString()}</p>
                                </div>
                                <div class="resume-actions">
                                    <button class="btn secondary-btn"><i class="fas fa-download"></i> Download</button>
                                    <button class="btn secondary-btn"><i class="fas fa-trash"></i> Delete</button>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        resumeList.innerHTML = '<p>No resumes uploaded yet.</p>';
                    }
                }
            } catch (error) {
                console.error('Error loading resumes:', error);
            }
        }

        // Resume Upload
        const fileInput = document.getElementById('resume-file');
        const uploadBtn = document.querySelector('.upload-area .btn');
        
        uploadBtn.addEventListener('click', () => fileInput.click());
        
        fileInput.addEventListener('change', async function() {
            if (this.files && this.files[0]) {
                const file = this.files[0];
                const formData = new FormData();
                formData.append('file', file);
                formData.append('user_id', currentUser.id);
                
                const uploadArea = document.querySelector('.upload-area');
                const originalContent = uploadArea.innerHTML;
                uploadArea.innerHTML = '<p><i class="fas fa-spinner fa-spin"></i> Uploading...</p>';
                
                try {
                    const response = await fetch(`${API_BASE}/resumes/upload`, {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (response.ok) {
                        alert('Resume uploaded successfully!');
                        loadResumes();
                    } else {
                        const error = await response.json();
                        alert(error.error || 'Upload failed');
                    }
                } catch (error) {
                    console.error('Error uploading resume:', error);
                    alert('An error occurred during upload');
                } finally {
                    uploadArea.innerHTML = originalContent;
                    // Re-attach event listener since we replaced innerHTML
                    document.querySelector('.upload-area .btn').addEventListener('click', () => document.getElementById('resume-file').click());
                }
            }
        });
        
        // Add skill functionality
        document.querySelector('.skill-input-container .btn').addEventListener('click', function() {
            const skillInput = document.getElementById('skill-input');
            const skillValue = skillInput.value.trim();
            
            if (skillValue) {
                const proficiencyLevel = document.getElementById('proficiency-level').value;
                const proficiencyText = document.getElementById('proficiency-level').options[proficiencyLevel - 1].text;
                
                // Calculate width based on proficiency level
                const widthPercentage = proficiencyLevel * 25; // 25% per level
                
                // Add new skill to the list
                const skillsList = document.querySelector('.skills-list');
                const newSkillItem = document.createElement('div');
                newSkillItem.className = 'skill-item';
                newSkillItem.innerHTML = `
                    <span class="skill-name">${skillValue}</span>
                    <div class="skill-proficiency">
                        <div class="proficiency-bar">
                            <div class="proficiency-level" style="width: ${widthPercentage}%;"></div>
                        </div>
                        <span class="proficiency-text">${proficiencyText}</span>
                    </div>
                    <button class="btn secondary-btn"><i class="fas fa-trash"></i></button>
                `;
                
                skillsList.appendChild(newSkillItem);
                
                // Clear input
                skillInput.value = '';
                
                // Add delete functionality to new button
                newSkillItem.querySelector('.btn').addEventListener('click', function() {
                    newSkillItem.remove();
                });
            }
        });
        
        // Add delete functionality to existing skill buttons
        document.querySelectorAll('.skill-item .btn').forEach(button => {
            button.addEventListener('click', function() {
                this.parentElement.remove();
            });
        });
    </script>
</body>
</html>